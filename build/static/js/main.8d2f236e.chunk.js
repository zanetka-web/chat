(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),o=a(7),r=a.n(o),s=(a(13),a(14),a(2)),i=a(5),l=a(1),u=new WebSocket("ws://chat.shas.tel");var m={messages:[],user:null,logged:!1,info:""};function d(e,t){switch(t.type){case"SET_USER":return localStorage.setItem("user",t.payload),Object(l.a)(Object(l.a)({},e),{},{user:t.payload});case"LOGIN":return Object(l.a)(Object(l.a)({},e),{},{logged:!0,info:""});case"LOGOUT":var a="";return t.payload.error&&(a="You were disconnected, click in login to join the chat again..."),Object(l.a)(Object(l.a)({},e),{},{logged:!1,messages:[],info:a});case"RECEIVE_MSG":return Object(l.a)(Object(l.a)({},e),{},{messages:[].concat(Object(i.a)(e.messages),Object(i.a)(t.payload))});case"SEND_MSG":return n={from:e.user,message:t.payload},u.send(JSON.stringify(n)),e;default:return e}var n}var f=c.a.createContext();var g=function(e){var t=Object(n.useReducer)(d,m),a=Object(s.a)(t,2),o=a[0],r=a[1];return u.onopen=function(e){console.log("connected",e)},u.onmessage=function(e){var t=JSON.parse(e.data).reverse();r({type:"RECEIVE_MSG",payload:t})},u.onclose=function(){r({type:"LOGOUT"})},u.onerror=function(){r({type:"LOGOUT",payload:{error:!0}})},Object(n.useEffect)((function(){var e,t=o.messages.length,a=t&&o.messages[t-1];a&&o.user!==a.from&&o.logged&&!document.hasFocus()&&(e="From: ".concat(a.from," - ").concat(a.message),"Notification"in window?"granted"===Notification.permission?new Notification(e):"denied"!==Notification.permission&&Notification.requestPermission().then((function(t){"granted"===t&&new Notification(e)})):console.error("browser can not show notifications"))})),c.a.createElement(f.Provider,{value:{state:o,dispatch:r}},e.children)};var E=function(){var e=Object(n.useState)(localStorage.getItem("user")||""),t=Object(s.a)(e,2),a=t[0],o=t[1],r=Object(n.useContext)(f),i=r.state,l=r.dispatch;return Object(n.useEffect)((function(){i.user&&l({type:"LOGIN"})}),[i.user,l]),c.a.createElement("div",{className:"login"},c.a.createElement("input",{type:"text",onChange:function(e){o(e.target.value)},value:a,placeholder:"Nickname..."}),c.a.createElement("button",{onClick:function(){a&&l({type:"SET_USER",payload:a})},disabled:!a},"Login"),c.a.createElement("p",{className:"info"},i.info))};var p=function(e){return c.a.createElement("div",{className:e.user===e.message.from?"message me":"message"},c.a.createElement("span",{className:"user"},e.message.from),c.a.createElement("span",{className:"text"},e.message.message))};var v=function(){var e=Object(n.useContext)(f).state;return c.a.createElement("div",{className:"messages"},e.messages.map((function(t){return c.a.createElement(p,{message:t,key:t.id,user:e.user})})))};var O=function(){var e=Object(n.useContext)(f).dispatch,t=Object(n.useState)(""),a=Object(s.a)(t,2),o=a[0],r=a[1];return c.a.createElement("div",{className:"input-message"},c.a.createElement("input",{type:"text",placeholder:"Add msg here...",value:o,onChange:function(e){r(e.target.value)}}),c.a.createElement("button",{onClick:function(){e({type:"SEND_MSG",payload:o}),r("")}},"SEND"))};var h=function(){return c.a.createElement("div",null,c.a.createElement(v,null),c.a.createElement(O,null))};var b=function(){var e=Object(n.useContext)(f).state,t=Object(n.useState)(c.a.createElement(E,null)),a=Object(s.a)(t,2),o=a[0],r=a[1];return Object(n.useEffect)((function(){e.logged?r(c.a.createElement(h,null)):r(c.a.createElement(E,null))}),[e.logged]),c.a.createElement("div",{className:"chat"},c.a.createElement("h1",null,"RS School - Chat"),o)};var j=function(){return c.a.createElement(g,null,c.a.createElement(b,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,a){e.exports=a(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.8d2f236e.chunk.js.map